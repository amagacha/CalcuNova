<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>CalcuNova</title>
<style>
    /* フォントと全体調整 */
    body {
        margin: 0;
        font-family: 'Segoe UI', 'Helvetica', sans-serif;
        background-color: #f5f5f5;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        flex-direction: column;
    }

    h1 {
        font-size: 3rem;
        margin-bottom: 2rem;
    }

    .hidden { display: none; }

    button {
        font-size: 1.2rem;
        margin: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        background-color: #4CAF50;
        color: white;
    }

    button:hover { background-color: #45a049; }

    #home, #gameArea, #resultArea {
        text-align: center;
    }

    #keypad {
        display: grid;
        grid-template-columns: repeat(3, 60px);
        gap: 10px;
        justify-content: center;
        margin-top: 1rem;
    }

    #version {
        position: absolute;
        bottom: 10px;
        right: 10px;
        font-size: 0.8rem;
        color: gray;
    }

    input[type="number"] {
        font-size: 2rem;
        width: 120px;
        text-align: center;
    }

    #question {
        font-size: 2rem;
        margin: 1rem 0;
    }

    #score, #timer, #combo {
        font-size: 1.2rem;
        margin: 0.5rem 0;
    }
</style>
</head>
<body>

<div id="home">
    <h1>CalcuNova</h1>
    <p>学年を選択してスタート</p>
    <div id="gradeButtons"></div>
    <div id="version">β0.0.0</div>
</div>

<div id="gameArea" class="hidden">
    <div id="timer">Time: 0</div>
    <div id="score">Score: 0</div>
    <div id="combo">Combo: 0</div>
    <div id="question"></div>
    <input type="number" id="answer" readonly>
    <div id="keypad"></div>
    <button onclick="checkAnswer()">決定</button>
</div>

<div id="resultArea" class="hidden">
    <h2>結果</h2>
    <p id="finalScore"></p>
    <button onclick="restart()">もう一回</button>
</div>

<script>
let score = 0;
let combo = 0;
let timeLeft = 0;
let timerInterval;
let currentAnswer = 0;
let currentGrade = 1;

// ホーム画面：学年ボタン生成
const gradeButtons = document.getElementById('gradeButtons');
for(let g=1; g<=6; g++){
    const btn = document.createElement('button');
    btn.textContent = g+'年生';
    btn.onclick = ()=>startGame(g);
    gradeButtons.appendChild(btn);
}

// キーパッド作成
const keypadContainer = document.getElementById('keypad');
function generateKeypad(){
    keypadContainer.innerHTML='';
    for(let i=1;i<=9;i++){
        const btn = document.createElement('button');
        btn.textContent=i;
        btn.onclick=()=>document.getElementById('answer').value+=i;
        keypadContainer.appendChild(btn);
    }
    const zeroBtn = document.createElement('button');
    zeroBtn.textContent='0';
    zeroBtn.onclick=()=>document.getElementById('answer').value+='0';
    keypadContainer.appendChild(zeroBtn);

    const clearBtn = document.createElement('button');
    clearBtn.textContent='C';
    clearBtn.onclick=()=>document.getElementById('answer').value='';
    keypadContainer.appendChild(clearBtn);
}

// スタートゲーム
function startGame(grade){
    currentGrade = grade;
    document.getElementById('home').classList.add('hidden');
    document.getElementById('gameArea').classList.remove('hidden');
    score = 0;
    combo = 0;
    timeLeft = grade*30;
    document.getElementById('timer').textContent = 'Time: '+timeLeft;
    document.getElementById('score').textContent = 'Score: '+score;
    document.getElementById('combo').textContent = 'Combo: '+combo;
    generateKeypad();
    newQuestion();
    startTimer();
}

// タイマー
function startTimer(){
    clearInterval(timerInterval);
    timerInterval = setInterval(()=>{
        timeLeft--;
        document.getElementById('timer').textContent = 'Time: '+timeLeft;
        if(timeLeft<=0){
            clearInterval(timerInterval);
            endGame();
        }
    },1000);
}

// 問題生成
function newQuestion(){
    let num1,num2,op;
    if(currentGrade===1){
        op = Math.random()<0.5?'+':'-';
        num1 = Math.floor(Math.random()*9)+1;
        num2 = Math.floor(Math.random()*9)+1;
    } else if(currentGrade===2){
        const r = Math.random();
        if(r<1/3){
            op = '+';
            num1 = Math.floor(Math.random()*100)+1;
            num2 = Math.floor(Math.random()*100)+1;
        } else if(r<2/3){
            op = '-';
            num1 = Math.floor(Math.random()*100)+1;
            num2 = Math.floor(Math.random()*100)+1;
        } else {
            op = '×';
            num1 = Math.floor(Math.random()*9)+1;
            num2 = Math.floor(Math.random()*9)+1;
        }
    } else {
        op = '+';
        num1 = Math.floor(Math.random()*10)+1;
        num2 = Math.floor(Math.random()*10)+1;
    }
    currentAnswer = eval(num1+op.replace('×','*')+num2);
    document.getElementById('question').textContent=num1+' '+op+' '+num2;
}

// 答え判定
function checkAnswer(){
    const input = Number(document.getElementById('answer').value);
    if(input===currentAnswer){
        score++;
        combo++;
        if(combo>=3) timeLeft++;
        document.getElementById('score').textContent='Score: '+score;
        document.getElementById('combo').textContent='Combo: '+combo;
    } else {
        combo=0;
        document.getElementById('combo').textContent='Combo: 0';
    }
    document.getElementById('answer').value='';
    newQuestion();
}

// 結果
function endGame(){
    document.getElementById('gameArea').classList.add('hidden');
    document.getElementById('resultArea').classList.remove('hidden');
    document.getElementById('finalScore').textContent='スコア: '+score;
}

// もう一回
function restart(){
    document.getElementById('resultArea').classList.add('hidden');
    document.getElementById('home').classList.remove('hidden');
}
</script>

</body>
</html>